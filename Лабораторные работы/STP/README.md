# Лабораторная работа.
## Развертывание коммутируемой сети с резервными каналами

### Цели:  
Часть 1. Создание сети и настройка основных параметров устройства  
Часть 2. Выбор корневого моста  
Часть 3. Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов  
Часть 4. Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов  

# Часть 1.  
### Создадим сеть согласно топологии:
#### Таблица адресации
Устройство | Интерфейс | IP-адрес   | Маска подсети 
-----------|-----------|------------|----------------
S1         | VLAN 1    | 192.168.1.1| 255.255.255.0  
S2         | VLAN 1    | 192.168.1.2| 255.255.255.0
S3         | VLAN 1    | 192.168.1.3| 255.255.255.0

#### Топология
![alt-текст](https://github.com/stanlaz/otus_network_engineer/blob/main/Лабораторные%20работы/STP/topology.png)

### Далее настроим базовые параметры каждого коммутатора и зададим ip адреса согласно таблице адрессации.    
#### Пример конфигурации:  

 hostname S2  
!  
 line console 0  
 password cisco  
 exec-timeout 15 0  
 login  
 logging synchronous  
!  
 line vty 0 4  
 password cisco  
 exec-timeout 15 0  
 login  
 logging synchronous  
!  
 enable secret cisco  
!  
service password-encryption  
!  
 banner motd $accessing the device that unauthorized access is  prohibited  
!  
no ip domain lookup  
!  
vlan1  
interface Vlan1  
 ip address 192.168.1.2 255.255.255.0  
!  
 write  

### Теперь проверим способность коммутаторов обмениваться эхо-запросами

![alt-текст](https://github.com/stanlaz/otus_network_engineer/blob/main/Лабораторные%20работы/STP/ping%20S1%20to%20S2%2C%20S3.png)  
![alt-текст](https://github.com/stanlaz/otus_network_engineer/blob/main/Лабораторные%20работы/STP/ping%20S2%20to%20S3.png)  
Как видим эхо запросы успешно выполняются.  

# Часть 2.  
### Определим корневой мост
Для этого: 
* Отключим все порты на коммутаторах.  
* Настроим подключенные порты в качестве транковых.
* Включим порты e0/1 и e0/3 на всех коммутаторах.
* Отобразим данные протокола spanning-tree.
#### Пример конфигурации:

interface range e0/0-3  
!  
shutdown  
!  
switchport trunk allowed vlan 1  
!  
switchport trunk encapsulation dot1q  
!  
switchport mode trunk  
!  
switchport trunk allowed vlan 1  
!  
interface range e0/1, e0/3  
!  
no shutdown  
#### конфигурация STP на коммутаторах
![alt-текст](https://github.com/stanlaz/otus_network_engineer/blob/main/Лабораторные%20работы/STP/show_stp.png)  

С учетом выходных данных коммутаторов имеем:
- Коммутатор S1 является корневым мостом
- S1 был выбран в качестве корневого моста, потому что имеет наименьшее значение идентификатора моста (BID):  
все три коммутатора имеют равные значения расширенного идентификатора системы (32769 = 32768 + 1, где приоритет по умолчанию = 32768, номер сети VLAN = 1), но коммутатор S1 имеет самое низкое значение MAC-адреса  
- корневыми портами являются e0/3 коммутатора S2 e0/1 коммутатора S3  
- назначенными портами являются e0/1 и e0/3 коммутатора S1, e0/1 коммутатора S2.
- порт e0/3 коммутатора S3 является альтернативным и на данный момент заблокирован  
- stp выбрал порт e0/3 S3 в качестве альтернативного, так как коммутатор S3 имеет наибольшее значение идентификатора BID   
# Часть 3:
###	Наблюдаем за процессом выбора протоколом STP порта, исходя из стоимости портов
Как видно из текущей конфигурации порт e0/3 на коммутаторе S3  заблокирован STP по наибольшему значению BID, при том, что  стоимость корневых портов на коммутаторах S2 и S3  одинакова.  
Уменьшим стоимость корневого порта на коммутаторе S3, Теперь stp блокирует порт e0/1 на коммутаторе S2, поскольку  алгоритм протокола spanning-tree (STA) определяет, какие порты  будут заблокированы, исходя из стоимости пути. Порт с более  низкой стоимостью пути является предпочтительным.  
S3(config)# interface e0/1  
S3(config-if)# spanning-tree cost 90  
#### измененная конфигурация stp на коммутаторах:  
![alt-текст](https://github.com/stanlaz/otus_network_engineer/blob/main/Лабораторные%20работы/STP/show_stp_cost.png)  

Удалим изменения стоимости порта и проверим, что протокол STP сбросил порт на коммутаторе некорневого моста, вернув исходные настройки порта.

# Часть 4:
### Наблюдаем за процессом выбора протоколом STP порта, исходя из приоритета портов

- Включим ранее заблокированные порты e0/0 и e0/2 на всех коммутаторах.  
- Ждем 30 секунд, чтобы протокол STP завершил процесс перевода порта, после чего выполним команду show spanning-tree на коммутаторах некорневого моста. Видим, что порт e0/2 коммутатора S2 и e0/0 коммутатора S3 выбраны протоколом STP в качестве корневых портов, а так же stp заблокировал предыдущий корневой порт.  
В нашем примере стоимости портов равны, значит для определения корневого порта используются приоритеты портов. Протоколом STP выбираетются наиболее низкие значения. 
![alt-текст](https://github.com/stanlaz/otus_network_engineer/blob/main/Лабораторные%20работы/STP/show_stp_all_ports.png)






